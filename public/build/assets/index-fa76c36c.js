import{G as J,s as P,B as V,H as K,C as g,S as T,d as z,r as S,x as Q,b as G,v as H,c as m,o as i,e as u,f as e,t as a,l as f,i as x,F as w,k as I,j as h,q as _,h as E,w as R,z as W,D,g as v,I as q}from"./app-4aaa95f7.js";import{_ as X}from"./lodash-ef35d7ba.js";const Z=J({id:"advertisement",state:()=>({advertisements:[],pagination:{current_page:1,last_page:1,per_page:1,total:0},isLoading:!0,filters:{}}),getters:{},actions:{async fetch(y=!1,o=!1){this.isLoading=!0;let d={pagination:1};this.filters.search&&(d.search=this.filters.search),this.filters.order_by&&(d.order_by=this.filters.order_by),this.filters.user_id&&(d.user_id=this.filters.user_id),y&&(o?this.pagination.current_page--:this.pagination.current_page++);try{const{data:p}=await P.get(`/dashboard/advertisements?page=${this.pagination.current_page}`,{params:{...d}});p.ok&&(this.advertisements=p.advertisements.data,this.pagination={current_page:p.advertisements.current_page,last_page:p.advertisements.last_page,per_page:p.advertisements.per_page,total:p.advertisements.total}),await V(),this.isLoading=!1}catch{this.isLoading=!1}},async onDelete(y){const{value:o}=await K.fire({title:g("Are you sure?"),text:g("You can restore this advertisement later."),icon:"warning",showCancelButton:!0,confirmButtonText:g("Yes, delete it!"),cancelButtonText:g("No, keep it")});if(o)try{const{data:d}=await P.delete(`/dashboard/advertisements/${y}`);if(d.ok){let p=this.advertisements.find(k=>k.id===y);p&&(p.deleted_at=new Date().toISOString())}await V(),T({group:"dashboard",ok:d.ok,title:d.ok?g("Success"):g("Error"),text:d.message},2e3)}catch(d){console.log(d)}},async onRestore(y){try{const{data:o}=await P.delete(`/dashboard/advertisements/${y}`);if(o.ok){let d=this.advertisements.find(p=>p.id===y);d&&(d.deleted_at=null)}await V(),T({group:"dashboard",ok:o.ok,title:o.ok?g("Success"):g("Error"),text:o.message},2e3)}catch(o){console.log(o)}}}}),ee={key:0,class:"flex flex-col gap-1 mb-5"},te={for:"status",class:"text-gray-800 text-[14.4px] font-semibold"},se=["value"],ae={key:1,class:"flex flex-col divide-y divide-gray-200"},oe={class:"h-12 w-12 rounded-full relative overflow-hidden"},le=["src","alt"],ne={class:"flex flex-col gap-1 w-full"},re={class:"flex justify-between"},ie={class:"font-bold text-gray-800 w-full flex-1"},de={class:"flex gap-1 items-center"},ce={class:"flex items-center gap-1"},ue=["onClick"],pe=["onClick"],_e={class:"text-[11.1px] text-gray-600"},ge={class:"text-gray-900 font-medium"},fe={key:1,class:"flex flex-col gap-5 w-full"},ve={class:"flex flex-col gap-1"},he={for:"status",class:"text-gray-800 text-[14.4px] font-semibold"},xe={value:"approved"},ye={value:"pending"},me={value:"rejected"},ke={key:0,class:"flex flex-col gap-1"},be={for:"rejection_reason",class:"text-gray-800 text-[14.4px] font-semibold"},we={class:"flex gap-2 justify-end"},$e={key:0,class:"flex justify-center"},Ce={key:2,class:"flex items-center justify-center p-4"},je=z({__name:"comments",props:{advertisement:{}},setup(y){const o=y,d=S([]),p=S({current_page:1,last_page:1,per_page:10,total:0}),k=S({status:"all"}),b=S(!1),l=S(null),s=Q("$swal");G(k,async()=>{p.value={current_page:1,last_page:1,per_page:10,total:0},d.value=[],await $()},{deep:!0});const U=n=>{switch(n){case"approved":return"green";case"pending":return"yellow";case"rejected":return"red";default:return"gray"}},$=async(n=1)=>{if(!o.advertisement.id)return;b.value=!0;let t={};k.value.status!=="all"&&(t.status=k.value.status);try{const{data:c}=await axios.get(`/advertisements/${o.advertisement.id}/comments?page=${n}`,{params:t});c.ok&&(d.value=[...d.value,...c.comments.data],p.value={current_page:c.comments.current_page,last_page:c.comments.last_page,per_page:c.comments.per_page,total:c.comments.total})}catch(c){console.error(c)}finally{b.value=!1}},C=async n=>{if(o.advertisement.id){b.value=!0;try{const{data:t}=await axios.put(`/dashboard/advertisements/${o.advertisement.id}/comments/${n.id}`,{status:n.status,rejection_reason:n.rejection_reason});t.ok&&(d.value=d.value.map(c=>c.id===n.id?{...c,status:n.status,rejection_reason:n.rejection_reason}:c),l.value=null),T({group:"dashboard",ok:t.ok,title:t.ok?R("Success"):R("Error"),text:t.message},2e3)}catch(t){console.error(t)}finally{b.value=!1}}},F=async n=>{if(!o.advertisement.id)return;const{isConfirmed:t}=await s.fire({title:g("Are you sure?"),text:g("You won't be able to revert this!"),icon:"warning",showCancelButton:!0,confirm:g("Yes, delete it!"),cancel:g("No, cancel!")});if(t)try{const{data:c}=await axios.delete(`/dashboard/advertisements/${o.advertisement.id}/comments/${n}`);c.ok&&(d.value=d.value.filter(A=>A.id!==n)),T({group:"dashboard",ok:c.ok,title:c.ok?R("Success"):R("Error"),text:c.message},2e3)}catch(c){console.error(c)}};return H(async()=>{await $()}),(n,t)=>{const c=m("v-select"),A=m("v-badge"),N=m("v-textarea"),B=m("v-button"),L=m("v-loader");return i(),u(w,null,[l.value?h("",!0):(i(),u("div",ee,[e("label",te,a(n.$t("Filter by status")),1),f(c,{value:k.value.status,id:"status","onUpdate:value":t[0]||(t[0]=r=>k.value.status=r)},{default:x(()=>[(i(!0),u(w,null,I([{label:n.$t("All"),value:"all"},{label:n.$t("Approved"),value:"approved"},{label:n.$t("Pending"),value:"pending"},{label:n.$t("Rejected"),value:"rejected"}],r=>(i(),u("option",{value:r.value,key:r.value},a(r.label),9,se))),128))]),_:1},8,["value"])])),b.value?(i(),u("div",Ce,[f(L,{size:4,dark:!0})])):(i(),u("div",ae,[(i(!0),u(w,null,I(d.value,r=>{var M,O,Y;return i(),u("div",{class:"flex gap-2 py-3",key:r.id},[l.value!==r.id?(i(),u(w,{key:0},[e("div",oe,[e("img",{class:"object-cover absolute inset-0 h-full w-full",src:((M=r.user)==null?void 0:M.avatar_url)??`https://ui-avatars.com/api/?name=${r.name}&color=333333&background=F4F4F4F4`,alt:((O=r.user)==null?void 0:O.name)??r.name},null,8,le)]),e("div",ne,[e("div",re,[e("div",ie,[_(a((Y=r.user)!=null&&Y.id?r.user.name:r.name)+" ",1),t[3]||(t[3]=e("i",{class:"icon text-[12px] mgc_check_2_fill text-blue-700"},null,-1))]),e("div",de,[e("span",ce,[l.value!==r.id?(i(),E(A,{key:0,color:U(r.status),text:n.$t(r.status)},null,8,["color","text"])):h("",!0),l.value!==r.id?(i(),u("i",{key:1,class:"icon mgc_pen_2_fill text-gray-800 hover:text-blue-800 cursor-pointer",onClick:j=>l.value=r.id},null,8,ue)):h("",!0),l.value!==r.id?(i(),u("i",{key:2,class:"icon mgc_delete_2_line text-gray-800 hover:text-red-800 cursor-pointer",onClick:j=>F(r.id)},null,8,pe)):h("",!0)])])]),e("span",_e,a(n.$t("Posted on :date",{date:r.created_at})),1),e("div",ge,a(r.content),1)])],64)):(i(),u("div",fe,[e("div",ve,[e("label",he,a(n.$t("Status")),1),f(c,{id:"status",value:r.status,"onUpdate:value":j=>r.status=j},{default:x(()=>[e("option",xe,a(n.$t("Approved")),1),e("option",ye,a(n.$t("Pending")),1),e("option",me,a(n.$t("Rejected")),1)]),_:1},8,["value","onUpdate:value"])]),r.status==="rejected"?(i(),u("div",ke,[e("label",be,a(n.$t("Rejection reason")),1),f(N,{id:"rejection_reason",value:r.rejection_reason,"onUpdate:input":j=>r.rejection_reason=j},null,8,["value","onUpdate:input"])])):h("",!0),e("div",we,[f(B,{type:"button",color:"red",onClick:t[1]||(t[1]=j=>l.value=null)},{default:x(()=>[_(a(n.$t("Cancel")),1)]),_:1}),f(B,{type:"button",color:"blue",onClick:j=>C(r)},{default:x(()=>[_(a(n.$t("Update")),1)]),_:1},8,["onClick"])])]))])}),128)),p.value.last_page>1&&p.value.current_page<p.value.last_page?(i(),u("div",$e,[f(B,{type:"button",loading:b.value,color:"blue",class:"w-full",disabled:b.value,onClick:t[2]||(t[2]=r=>$(p.value.current_page+1))},{default:x(()=>[_(a(n.$t("Load more")),1)]),_:1},8,["loading","disabled"])])):h("",!0)]))],64)}}}),Se={class:"flex flex-col"},Ae={class:"-m-1.5 overflow-x-auto"},Be={class:"p-1.5 min-w-full"},Ee={class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden dark:bg-slate-900 dark:border-gray-700"},Ne={class:"px-6 py-4 grid gap-3 md:flex md:justify-between md:items-center border-b border-gray-200 dark:border-gray-700"},Le={class:"text-xl font-semibold text-gray-800 dark:text-gray-200"},Re={class:"text-sm text-gray-600 dark:text-gray-400"},De={class:"flex flex-col md:flex-row gap-2"},Te={class:"relative overflow-x-auto"},Ue={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Fe={class:"bg-gray-50 dark:bg-slate-800 rtl:text-right ltr:text-left"},Pe={scope:"col",class:"px-6 py-2"},Ve={class:"text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-200 whitespace-nowrap"},qe={scope:"col",class:"px-6 py-2"},Ie={class:"text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-200 whitespace-nowrap"},Me={scope:"col",class:"px-6 py-2"},Oe={class:"text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-200 whitespace-nowrap"},Ye={scope:"col",class:"px-6 py-2"},ze={class:"text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-200 whitespace-nowrap"},Ge={scope:"col",class:"px-6 py-2"},He={class:"text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-200 whitespace-nowrap"},Je={scope:"col",class:"px-6 py-2"},Ke={class:"text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-20 whitespace-nowrap"},Qe={class:"divide-y divide-gray-200 dark:divide-gray-700"},We={class:"px-6 py-2"},Xe={class:"flex items-center gap-2 whitespace-nowrap"},Ze=["src","alt"],et={class:"px-6 py-2"},tt={class:"block",href:"#"},st={class:"flex items-center gap-x-3"},at=["src","alt"],ot={class:"grow"},lt={class:"block text-sm font-semibold text-gray-800 dark:text-gray-200"},nt={class:"block text-sm text-gray-500"},rt={key:0,class:"block font-semibold text-[12.2px] text-red-700 whitespace-nowrap"},it={class:"px-6 py-2"},dt={class:"flex flex-col items-center gap-1"},ct={class:"px-6 py-2"},ut={class:"px-6 py-2"},pt={class:"px-6 py-2"},_t={class:"whitespace-nowrap text-sm text-gray-800 dark:text-gray-200 flex items-center gap-1"},gt={key:0,class:"icon mgc_right_fill"},ft={class:"h-px px-6 py-2"},vt={class:"px-6 py-2"},ht={class:"flex justify-end gap-x-2"},xt={key:1},yt={colspan:"6"},mt={class:"flex items-center justify-center p-4"},kt={key:0,class:"px-6 py-4 grid gap-3 md:flex md:justify-between md:items-center border-t border-gray-200 dark:border-gray-700"},bt={class:"text-sm text-gray-600 dark:text-gray-400"},wt={class:"font-semibold text-gray-800 dark:text-gray-200"},$t={class:"inline-flex gap-x-2"},Ct=["disabled"],jt=["disabled"],St={class:"text-xl font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2"},Et=z({__name:"index",setup(y){const o=Z(),d=S(!1),p=S({}),k=l=>{switch(l){case q.PENDING:return"orange";case q.APPROVED:return"blue";case q.REJECTED:return"red";default:return"grey"}},b=l=>{switch(l){case"active":return`<i class='icon mgc_check_fill text-xl'></i> ${g("active")}`;case"pending":return`<i class='icon mgc_clock_line text-xl'></i> ${g("pending")}`;case"approved":return`<i class='icon mgc_check_fill text-xl'></i> ${g("approved")}`;case"rejected":return`<i class='icon mgc_close_fill text-xl'></i> ${g("rejected")}`;default:return`<i class='icon mgc_question_line text-xl'></i> ${g("Unknown")}`}};return G(o.filters,X.debounce(async()=>{await o.fetch()},500)),W(()=>{D.currentRoute.value.query.user_id&&(o.filters.user_id=parseInt(D.currentRoute.value.query.user_id))}),H(async()=>{await o.fetch()}),(l,s)=>{const U=m("v-input"),$=m("v-button"),C=m("v-badge"),F=m("v-loader"),n=m("v-modal");return i(),u(w,null,[e("div",Se,[e("div",Ae,[e("div",Be,[e("div",Ee,[e("div",Ne,[e("div",null,[e("h2",Le,[s[5]||(s[5]=e("i",{class:"icon mgc_certificate_line"},null,-1)),_(" "+a(l.$t("Advertisements")),1)]),e("p",Re,a(l.$t("Manage your advertisements")),1)]),e("div",De,[f(U,{placeholder:l.$t("Search"),"onUpdate:input":s[0]||(s[0]=t=>v(o).filters.search=t)},null,8,["placeholder"]),f($,{color:"green",class:"whitespace-nowrap",onClick:s[1]||(s[1]=t=>v(D).push({name:"advertisement.create"}))},{default:x(()=>[s[6]||(s[6]=e("i",{class:"icon mgc_add_circle_fill"},null,-1)),_(" "+a(l.$t("Create new advertisement")),1)]),_:1})])]),e("div",Te,[e("table",Ue,[e("thead",Fe,[e("tr",null,[e("th",Pe,[e("span",Ve,a(l.$t("Name")),1)]),e("th",qe,[e("span",Ie,a(l.$t("Owner")),1)]),e("th",Me,[e("span",Oe,a(l.$t("Category")),1)]),e("th",Ye,[e("span",ze,a(l.$t("Total comments")),1)]),e("th",Ge,[e("span",He,a(l.$t("Status")),1)]),e("th",Je,[e("span",Ke,a(l.$t("Address")),1)]),s[7]||(s[7]=e("th",{scope:"col",class:"px-6 py-2"},null,-1)),s[8]||(s[8]=e("th",{scope:"col",class:"px-6 py-2"},null,-1))])]),e("tbody",Qe,[v(o).isLoading?(i(),u("tr",xt,[e("td",yt,[e("div",mt,[v(o).isLoading?(i(),E(F,{key:0,size:4,dark:!0})):h("",!0)])])])):(i(!0),u(w,{key:0},I(v(o).advertisements,t=>{var c,A,N,B;return i(),u("tr",{key:t.id},[e("td",We,[e("div",Xe,[(c=t.main_media)!=null&&c.url_thumb?(i(),u("img",{key:0,src:t.main_media.url_thumb,alt:t.name,class:"inline-block h-[2.375rem] w-[2.375rem] rounded-full"},null,8,Ze)):h("",!0),_(" "+a(t.name),1)])]),e("td",et,[e("a",tt,[e("div",st,[e("img",{class:"inline-block h-[2.375rem] w-[2.375rem] rounded-full",src:t.user.avatar_url,alt:t.user.name},null,8,at),e("div",ot,[e("span",lt,a(t.user.name),1),e("span",nt,a(t.user.email),1),t.user.deleted_at?(i(),u("p",rt,[s[9]||(s[9]=e("i",{class:"icon mgc_alert_diamond_fill"},null,-1)),_(" "+a(l.$t("Account deleted at :date",{date:t.user.deleted_at})),1)])):h("",!0)])])])]),e("td",it,[e("div",dt,[f(C,{color:"blue",text:`${t.category.name}`},null,8,["text"]),t.sub_category?(i(),u(w,{key:0},[s[10]||(s[10]=e("i",{class:"icon mgc_down_fill"},null,-1)),f(C,{color:"green",text:`${t.sub_category.name}`},null,8,["text"])],64)):h("",!0)])]),e("td",ct,[f(C,{color:"blue",text:l.$t("Total comments: :count",{count:t.comments_count??0})},null,8,["text"])]),e("td",ut,[t.status?(i(),E(C,{key:0,color:k(t.status),text:b(t.status)},null,8,["color","text"])):h("",!0)]),e("td",pt,[e("span",_t,[_(a(((A=t.country)==null?void 0:A.name)??"N/A")+" ",1),(N=t.city)!=null&&N.name?(i(),u("i",gt)):h("",!0),_(" "+a(((B=t.city)==null?void 0:B.name)??"N/A"),1)])]),e("td",ft,[t.deleted_at?(i(),E(C,{key:0,color:"red",text:l.$t("Ad deleted at :date",{date:t.deleted_at})},null,8,["text"])):h("",!0)]),e("td",vt,[e("div",ht,[t.comments_count?(i(),E($,{key:0,color:"purple",class:"whitespace-nowrap",onClick:L=>{p.value=t,d.value=!0}},{default:x(()=>[s[11]||(s[11]=e("i",{class:"icon mgc_comment_2_line"},null,-1)),_(" "+a(l.$t("Comments management")),1)]),_:1},8,["onClick"])):h("",!0),f($,{color:"blue",class:"whitespace-nowrap",onClick:L=>v(D).push({name:"advertisement.edit",params:{id:t.id}})},{default:x(()=>[s[12]||(s[12]=e("i",{class:"icon mgc_edit_line"},null,-1)),_(" "+a(l.$t("Edit")),1)]),_:1},8,["onClick"]),f($,{color:t.deleted_at?"green":"red",class:"whitespace-nowrap",onClick:L=>t.deleted_at?v(o).onRestore(t.id):v(o).onDelete(t.id)},{default:x(()=>[t.deleted_at?(i(),u(w,{key:0},[s[13]||(s[13]=e("i",{class:"icon mgc_restore_line"},null,-1)),_(" "+a(l.$t("Restore")),1)],64)):(i(),u(w,{key:1},[s[14]||(s[14]=e("i",{class:"icon mgc_delete_line"},null,-1)),_(" "+a(l.$t("Delete")),1)],64))]),_:2},1032,["color","onClick"])])])])}),128))])])]),v(o).isLoading?h("",!0):(i(),u("div",kt,[e("div",null,[e("p",bt,[e("span",wt,a(v(o).pagination.total),1),_(" "+a(l.$t("Results")),1)])]),e("div",null,[e("div",$t,[e("button",{onClick:s[2]||(s[2]=t=>v(o).fetch(!0,!0)),disabled:v(o).pagination.current_page===1,type:"button",class:"py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-slate-900 dark:border-gray-700 dark:text-white dark:hover:bg-gray-800 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600"},[s[15]||(s[15]=e("svg",{class:"flex-shrink-0 w-4 h-4",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m15 18-6-6 6-6"})],-1)),_(" "+a(l.$t("Previous")),1)],8,Ct),e("button",{onClick:s[3]||(s[3]=t=>v(o).fetch(!0)),disabled:v(o).pagination.current_page===v(o).pagination.last_page,type:"button",class:"py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-slate-900 dark:border-gray-700 dark:text-white dark:hover:bg-gray-800 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600"},[_(a(l.$t("Next"))+" ",1),s[16]||(s[16]=e("svg",{class:"flex-shrink-0 w-4 h-4",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m9 18 6-6-6-6"})],-1))],8,jt)])])]))])])])]),f(n,{"is-open":d.value,"onUpdate:closeModal":s[4]||(s[4]=t=>{d.value=!1,p.value=null})},{title:x(()=>[e("h2",St,[s[17]||(s[17]=e("i",{class:"icon mgc_comment_2_line"},null,-1)),_(" "+a(l.$t("Comments management")),1)])]),content:x(()=>[f(je,{advertisement:p.value},null,8,["advertisement"])]),_:1},8,["is-open"])],64)}}});export{Et as default};
