import{d as R,r as B,W as H,b as A,v as T,X as F,o as c,e as d,P as O,Y as K,f as t,Z as I,l as x,t as p,j,B as V,$ as U,a0 as W,u as D,a1 as P,z as Q,c as L,F as E,k as $,g as o,i as h,a2 as Y,q as z,A as G,Q as J,a3 as X,n as k}from"./app-4aaa95f7.js";function Z(n,l=null){if(!n)return!1;const e=n.getBoundingClientRect(),r=l?l.getBoundingClientRect():{top:0,left:0,bottom:window.innerHeight,right:window.innerWidth};return e.bottom>=r.top&&e.top<=r.bottom&&e.right>=r.left&&e.left<=r.right}async function ee(n){return n?(await V(),n.value instanceof HTMLElement?n.value:n.value?document.querySelector(n.value):null):null}function te(n){let l=`0px 0px ${n.distance}px 0px`;n.top&&(l=`${n.distance}px 0px 0px 0px`);const e=new IntersectionObserver(r=>{r[0].isIntersecting&&(n.firstload&&n.emit(),n.firstload=!0)},{root:n.parentEl,rootMargin:l});return n.infiniteLoading.value&&e.observe(n.infiniteLoading.value),e}async function N(n,l){if(await V(),!n.top)return;const e=n.parentEl||document.documentElement;e.scrollTop=e.scrollHeight-l}const q=(n,l)=>{const e=n.__vccOpts||n;for(const[r,g]of l)e[r]=g;return e},se={},ne=n=>(U("data-v-d3e37633"),n=n(),W(),n),oe={class:"container"},re=ne(()=>t("div",{class:"spinner"},null,-1)),ae=[re];function le(n,l){return c(),d("div",oe,ae)}const ie=q(se,[["render",le],["__scopeId","data-v-d3e37633"]]),ce={class:"state-error"},de=R({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(n,{emit:l}){const e=n;let r=null,g=0;const b=B(null),m=B(""),{top:_,firstload:a,distance:v}=e,{identifier:M,target:S}=H(e),u={infiniteLoading:b,top:_,firstload:a,distance:v,parentEl:null,emit(){g=(u.parentEl||document.documentElement).scrollHeight,y.loading(),l("infinite",y)}},y={loading(){m.value="loading"},async loaded(){m.value="loaded",await N(u,g),Z(b.value,u.parentEl)&&u.emit()},async complete(){m.value="complete",await N(u,g),r==null||r.disconnect()},error(){m.value="error"}};function w(){r==null||r.disconnect(),r=te(u)}return A(M,w),T(async()=>{u.parentEl=await ee(S),w()}),F(()=>r==null?void 0:r.disconnect()),(f,s)=>(c(),d("div",{ref_key:"infiniteLoading",ref:b,class:"v3-infinite-loading"},[O(t("div",null,[I(f.$slots,"spinner",{},()=>[x(ie)],!0)],512),[[K,m.value=="loading"]]),m.value=="complete"?I(f.$slots,"complete",{key:0},()=>{var i;return[t("span",null,p(((i=f.slots)==null?void 0:i.complete)||"No more results!"),1)]},!0):j("",!0),m.value=="error"?I(f.$slots,"error",{key:1,retry:u.emit},()=>{var i;return[t("span",ce,[t("span",null,p(((i=f.slots)==null?void 0:i.error)||"Oops something went wrong!"),1),t("button",{class:"retry",onClick:s[0]||(s[0]=(...C)=>u.emit&&u.emit(...C))},"retry")])]},!0):j("",!0)],512))}}),ue=q(de,[["__scopeId","data-v-4bdee133"]]);const pe={class:"messenger_section"},_e={class:"messenger"},me={class:"messenger__left"},fe={class:"flex flex-col divide-y divide-gray-200 w-full flex-1"},ge=["onClick"],ve={class:"flex items-center gap-2 p-2 rounded cursor-pointer hover:bg-gray-100 overflow-hidden"},xe={class:"min-w-[40px] min-h-[40px] max-w-[40px] max-h-[40px] rounded-full overflow-hidden relative"},he=["src","alt"],be={class:"flex flex-col flex-1"},ye={class:"text-lg font-semibold"},we={class:"flex justify-between items-center gap-1 w-full relative"},Ce={class:"text-sm text-gray-500 whitespace-pre-line break-all"},ke={class:"text-xs text-gray-500"},je={key:0,class:"w-[15px] h-[15px] bg-red-500 text-white text-xs font-semibold rounded-full flex items-center justify-center absolute top-[-1rem] rtl:left-0 ltr:right-0"},Me={class:"messenger__right"},Se={key:0,class:"messenger__right__content"},Ee={class:"flex items-center justify-between gap-5 p-2 border-b"},Ie=["src","alt"],Be={class:"text-lg font-semibold text-gray-900"},Le={key:0,class:"flex gap-2 items-center relative"},$e={class:"w-[40px] h-[40px] overflow-hidden rounded-full"},ze=["src","alt"],Ne={class:"text-base font-bold text-gray-800"},Re={class:"messenger__right__content__body"},Te={class:"messenger__right__content__body__messages"},Oe={class:"text-[14.3px] break-words"},Ve=["onClick"],qe={class:"text-[#333] dark:text-white font-bold text-[12.2px] flex items-center gap-2"},He=["placeholder"],Ae={key:1,class:"flex items-center justify-center flex-1"},Fe={key:0,class:"flex items-center justify-center h-full"},Ke={class:"text-2xl font-semibold text-gray-500 flex items-center gap-1"},We=R({__name:"index",setup(n){const l=D(),e=P(),{user_id:r,advertisement_id:g,type:b}=l.query,m=async _=>{var a;if(e.messages.current_page<e.messages.last_page){_.loading(),await e.fetchMessages({page:e.messages.current_page+1,conversationId:(a=e.currentConversation)==null?void 0:a.id}).then(v=>{v&&setTimeout(async()=>_.loaded(),100)}).catch(()=>{_.error()});return}_.complete()};return Q(async()=>{r&&await e.openConversation({owner:r,advertisement_id:g??null,type:b??null})}),T(async()=>{await e.markAsRead()}),(_,a)=>{var S,u,y,w,f;const v=L("router-link"),M=L("v-loader");return c(),d("section",pe,[t("div",_e,[t("div",me,[t("ul",fe,[(c(!0),d(E,null,$(o(e).conversations_by_date,(s,i)=>(c(),d("li",{key:i,onClick:C=>o(e).openConversation({owner:s.contact.id}),class:k(["cursor-pointer",s.total_unread>0&&"bg-blue-50"])},[t("div",ve,[t("figure",xe,[t("img",{src:s.contact.avatar_url,alt:s.contact.name,class:"absolute inset-0 w-full h-full object-cover"},null,8,he)]),t("div",be,[t("h1",ye,p(s.contact.name),1),t("div",we,[t("span",Ce,p(s.last_message??"--"),1),t("time",ke,p(s.last_message_created_at),1),s.has_messages&&s.total_unread>0?(c(),d("span",je,p(s.total_unread),1)):j("",!0)])])])],10,ge))),128))])]),t("div",Me,[o(e).isChatOpen?(c(),d("div",Se,[!o(e).isLoadingMessages&&o(e).currentConversation?(c(),d(E,{key:0},[t("div",Ee,[x(v,{class:"flex items-center gap-2",to:{name:o(e).currentConversation.owner.is_business?"store.show":"profile_uid",params:{id:o(e).currentConversation.owner.id,slug:o(e).currentConversation.owner.slug}}},{default:h(()=>{var s,i,C;return[t("img",{src:(s=o(e).currentConversation.owner)==null?void 0:s.avatar_url,class:"w-[50px] h-[50px] rounded-full object-cover",alt:(i=o(e).currentConversation.owner)==null?void 0:i.name},null,8,Ie),t("h3",Be,p((C=o(e).currentConversation.owner)==null?void 0:C.name),1)]}),_:1},8,["to"]),(S=o(e).currentConversation.advertisement)!=null&&S.id?(c(),d("div",Le,[x(v,{to:{name:"show-advertisement",params:{id:(u=o(e).currentConversation.advertisement)==null?void 0:u.id,slug:(y=o(e).currentConversation.advertisement)==null?void 0:y.slug}}},{default:h(()=>{var s,i;return[t("figure",$e,[t("img",{src:(s=o(e).currentConversation.advertisement)==null?void 0:s.main_media,alt:(i=o(e).currentConversation.advertisement)==null?void 0:i.name,class:"w-full h-full object-cover"},null,8,ze)])]}),_:1},8,["to"]),x(v,{to:{name:"show-advertisement",params:{id:(w=o(e).currentConversation.advertisement)==null?void 0:w.id,slug:(f=o(e).currentConversation.advertisement)==null?void 0:f.slug}}},{default:h(()=>{var s;return[t("h1",Ne,p((s=o(e).currentConversation.advertisement)==null?void 0:s.name),1)]}),_:1},8,["to"]),a[3]||(a[3]=t("span",{class:"w-[5px] h-[5px] bg-blue-600 rounded-full absolute right-[-2.5px] top-[-2.5px] animate-ping"},null,-1))])):j("",!0)]),t("div",Re,[t("ul",Te,[(c(!0),d(E,null,$(o(e).messages.data,(s,i)=>(c(),d("li",{class:k(["relative",s.is_sender&&"place-self-end"])},[t("div",{class:k(["rounded w-[19rem] p-3 flex flex-col gap-1 relative z-10",s.is_sender?"bg-blue-50 text-black place-self-end":"bg-blue-600 text-white"])},[t("span",Oe,p(s.body),1),t("time",{class:k(["text-xs place-self-end",s.is_sender?"text-gray-500":"text-gray-300"])},p(s.created_at),3)],2),t("span",{class:k(["w-[15px] h-[15px] rotate-[45deg] absolute rtl:right-[-4px] rtl:bottom-[15px] ltr:left-[-4px] ltr:bottom-[15px]",s.is_sender?"bg-blue-50":"bg-blue-600"])},null,2)],2))),256))]),x(o(ue),{onInfinite:m,class:"flex items-center justify-center h-[3rem] mx-auto"},Y({error:h(({retry:s})=>[t("button",{onClick:s},p(_.$t("Retry")),9,Ve)]),spinner:h(()=>[x(M,{size:2,color:"blue"})]),_:2},[o(e).conversations.current_page===o(e).conversations.last_page?{name:"complete",fn:h(()=>[t("span",qe,[a[4]||(a[4]=t("i",{class:"icon mgc_check_line text-2xl"},null,-1)),z(" "+p(_.$t("No more messages")),1)])]),key:"0"}:void 0]),1024)]),t("form",{class:"bg-gray-500 relative overflow-hidden h-[5rem]",onSubmit:a[2]||(a[2]=G((...s)=>o(e).sendMessage&&o(e).sendMessage(...s),["prevent"]))},[O(t("textarea",{placeholder:_.$t("Entre message ..."),class:"absolute inset-0 w-full h-full border-0 ring-0 resize-none text-[14.3px] p-1 rtl:pl-[6rem] ltr:pr-[6rem]","onUpdate:modelValue":a[0]||(a[0]=s=>o(e).message=s),onKeydown:a[1]||(a[1]=X((...s)=>o(e).sendMessage&&o(e).sendMessage(...s),["enter"]))},null,40,He),[[J,o(e).message]]),a[5]||(a[5]=t("button",{type:"submit",class:"absolute top-0 h-full w-[5rem] bg-blue-600 text-white flex items-center justify-center rtl:left-0 ltr:right-0"},[t("i",{class:"icon mgc_send_line text-2xl"})],-1))],32)],64)):(c(),d("div",Ae,[x(M,{color:"blue",size:8})]))])):(c(),d(E,{key:1},[o(e).isChatOpen?j("",!0):(c(),d("div",Fe,[t("h1",Ke,[a[6]||(a[6]=t("i",{class:"icon mgc_chat_1_line text-4xl"},null,-1)),z(" "+p(_.$t("Select a conversation")),1)])]))],64))])])])}}});export{We as default};
