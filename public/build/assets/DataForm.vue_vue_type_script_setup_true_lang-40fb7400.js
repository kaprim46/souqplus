import{d as de,m as le,r as I,b as T,v as ne,c,o as a,e as d,f as s,t as i,l as u,j as n,g as m,i as f,F as C,k as w,h as ue,q as me,A as ce,I as fe,s as z,D as ye,S as $,w as h}from"./app-4aaa95f7.js";import{u as be}from"./CategoryStore-7fabd6e6.js";import{u as ge}from"./CustomerCategoryStore-cea6d995.js";import{u as ve}from"./CountryStore-2b00879a.js";import{u as he}from"./FilterStore-fc34adbf.js";import{_ as xe}from"./Options.vue_vue_type_script_setup_true_lang-00d5c27b.js";import{u as ke}from"./SubSubCategoryStore-6dacdc52.js";const Se={class:"flex flex-col lg:flex-row gap-4 divide-y divide-x-0 lg:divide-x lg:divide-y-0 divide-solid divide-gray-200 h-full"},Ce={class:"flex-1 grid gap-4 grid-cols-1 md:grid-cols-2 p-2 lg:p-4"},we={for:"name",class:"block text-sm mb-2 dark:text-white"},pe={key:0,class:"text-xs text-red-600 mt-2",id:"name-error"},$e={key:0},Me={for:"status",class:"block text-sm mb-2 dark:text-white"},Te={value:"pending"},Ue={value:"approved"},Ae={value:"rejected"},De={key:0,class:"text-xs text-red-600 mt-2",id:"status-error"},Fe={key:1},je={for:"reason",class:"block text-sm mb-2 dark:text-white"},Ee={key:0,class:"text-xs text-red-600 mt-2",id:"reason-error"},Le={for:"category_id",class:"block text-sm mb-2 dark:text-white"},Ne={value:"",disabled:"",selected:""},Oe=["value"],Be={key:0,class:"text-xs text-red-600 mt-2",id:"category_id-error"},Ge={key:2},Pe={for:"sub_category_id",class:"block text-sm mb-2 dark:text-white"},Re={value:"",disabled:"",selected:""},Ve=["value"],qe={key:0,class:"text-xs text-red-600 mt-2",id:"sub_category_id-error"},Ie={key:3},ze={for:"sub_sub_category_id",class:"block text-sm mb-2 dark:text-white"},Je={value:"",disabled:"",selected:""},He=["value"],Ke={key:0,class:"text-xs text-red-600 mt-2",id:"sub_sub_category_id-error"},Qe={for:"country_id",class:"block text-sm mb-2 dark:text-white"},We={value:"0"},Xe=["value"],Ye={key:0,class:"text-xs text-red-600 mt-2",id:"country_id-error"},Ze={key:4},_e={for:"city",class:"block text-sm mb-2 dark:text-white"},et={value:"0"},tt=["value"],ot={key:0,class:"text-xs text-red-600 mt-2",id:"city-error"},rt={for:"phone_number",class:"block text-sm mb-2 dark:text-white"},it={key:0,class:"text-xs text-red-600 mt-2",id:"country_code-error"},at={for:"price",class:"block text-sm mb-2 dark:text-white"},st={key:0,class:"text-xs text-red-600 mt-2",id:"price-error"},dt={key:5,class:"col-span-1 md:col-span-2 flex flex-col gap-5"},lt={class:"col-span-1 md:col-span-2"},nt={for:"description",class:"block text-sm mb-2 dark:text-white"},ut={key:0,class:"text-xs text-red-600 mt-2",id:"description-error"},mt={class:"col-span-1 md:col-span-2"},ct={for:"media",class:"block text-sm mb-2 dark:text-white"},ft={key:0,class:"text-xs text-red-600 mt-2",id:"media-error"},yt={key:0,class:"w-full lg:w-1/3 flex flex-col gap-5 divide-y divide-x-0 lg:divide-x lg:divide-y-0 divide-solid divide-gray-200 h-full"},bt={class:"p-4"},gt={for:"map",class:"block text-sm mb-2 dark:text-white"},vt={class:"relative overflow-hidden rounded-lg shadow-xl"},ht={key:0,class:"text-xs text-red-600 mt-2",id:"latitude-error"},xt={key:1,class:"text-xs text-red-600 mt-2",id:"longitude-error"},Tt=de({__name:"DataForm",props:{form:{type:Object,required:!0,default:()=>({name:"",category:{id:null},sub_category:{id:null},sub_sub_category:{id:null},country:{id:null},city:{id:null},user:{phone_number:"",country_code:"+212"},price:0,description:"",media:[],filters:[],latitude:void 0,longitude:void 0})},errors:{type:Object,required:!0}},emits:["update:form","update:errors"],setup(e,{emit:J}){var U;const H={mapTypeControl:!0,styles:[{featureType:"all",elementType:"labels.text",stylers:[{color:"#878787"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f9f5ed"}]},{featureType:"road.highway",elementType:"all",stylers:[{color:"#f5f5f5"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"all",stylers:[{color:"#aee0f4"}]}]},x=le(),y=((U=x.me)==null?void 0:U.role)==="admin"?be():ge(),k=ve(),b=he(),p=ke(),g=I(!1),M=I([]),l=e,S=J;T(()=>l.form.category,async t=>{t&&t.id?(await b.getFiltersByCategory(t.id),await y.fetchSubCategories(t.id)):(l.form.sub_category={id:null},l.form.sub_sub_category={id:null},p.subSubCategories=[],b.data_filters_category=[])},{immediate:!0,deep:!0}),T(()=>l.form.sub_category,async t=>{t&&t.id?(await b.getFiltersBySubCategory(t.id),await p.fetchSubSubCategories(t.id)):(l.form.sub_sub_category={id:null},p.subSubCategories=[],b.data_filters_category=[])},{immediate:!0,deep:!0}),T(()=>l.form.country,async t=>{t&&t.id?await k.fetchCities(!1,!1,t.id):l.form.city={id:null}},{immediate:!0,deep:!0});const K=t=>{l.form.filters=t},Q=t=>{Array.isArray(l.form.media)||(l.form.media=[]),l.form.media.length?l.form.media.push({id:t.id,is_main:!1}):l.form.media=[{id:t.id,is_main:!0}]},W=t=>{Array.isArray(l.form.media)&&(M.value.push(t.id),l.form.media=l.form.media.filter(o=>o.id!==t.id))},X=t=>{Array.isArray(l.form.media)&&(l.form.media=l.form.media.map(o=>(o.is_main=o.id===t.id,o)))},Y=async()=>{var t;g.value=!0;try{const{data:o}=await z.post(((t=x.me)==null?void 0:t.role)==="admin"?"/dashboard/advertisements":"/my/advertisements",{...l.form,mediaToDelete:M.value});o.ok&&(S("update:form",{}),await ye.push({name:"my-advertisement",params:{}})),S("update:errors",{}),$({group:"dashboard",ok:o.ok,title:o.ok?h("Success"):h("Error"),text:o.message},2e3)}catch(o){o.response.status===422?S("update:errors",o.response.data.errors):$({group:"dashboard",ok:!1,title:h("Error"),text:o.message},2e3)}finally{g.value=!1}},Z=async()=>{var t;g.value=!0;try{const{data:o}=await z.put(((t=x.me)==null?void 0:t.role)==="admin"?`/dashboard/advertisements/${l.form.id}`:`/my/advertisements/${l.form.id}`,{...l.form,mediaToDelete:M.value});S("update:errors",{}),$({group:"dashboard",ok:o.ok,title:o.ok?h("Success"):h("Error"),text:o.message},2e3)}catch(o){o.response.status===422?S("update:errors",o.response.data.errors):$({group:"dashboard",ok:!1,title:h("Error"),text:o.message},2e3)}finally{g.value=!1}};return ne(async()=>{l.form.id||(Array.isArray(l.form.media)?l.form.media=[]:l.form.media=[],l.form.latitude=void 0,l.form.longitude=void 0),await y.fetch(),await k.fetchCountries()}),(t,o)=>{var D,F,j,E,L,N,O,B,G,P,R,V;const A=c("v-input"),v=c("v-select"),_=c("v-textarea"),ee=c("v-phoneInput"),te=c("v-editor"),oe=c("v-media"),re=c("GMapMarker"),ie=c("GMapMap"),ae=c("v-button");return a(),d("form",{onSubmit:o[14]||(o[14]=ce(r=>e.form.id?Z():Y(),["prevent"])),class:"flex flex-col gap-5"},[s("div",Se,[s("div",Ce,[s("div",null,[s("label",we,i(t.$t("Ad Name")),1),u(A,{type:"text",id:"name","aria-describedby":"name-error",value:e.form.name,placeholder:t.$t("Ad Name"),"onUpdate:input":o[0]||(o[0]=r=>e.form.name=r)},null,8,["value","placeholder"]),e.errors.name?(a(),d("p",pe,i(e.errors.name[0]),1)):n("",!0)]),((D=m(x).me)==null?void 0:D.role)==="admin"?(a(),d("div",$e,[s("label",Me,i(t.$t("Status")),1),u(v,{id:"status",value:e.form.status,"onUpdate:value":o[1]||(o[1]=r=>e.form.status=r)},{default:f(()=>[s("option",Te,i(t.$t("Pending")),1),s("option",Ue,i(t.$t("Approved")),1),s("option",Ae,i(t.$t("Rejected")),1)]),_:1},8,["value"]),e.errors.status?(a(),d("p",De,i(e.errors.status[0]),1)):n("",!0)])):n("",!0),((F=m(x).me)==null?void 0:F.role)==="admin"&&e.form.status===m(fe).REJECTED?(a(),d("div",Fe,[s("label",je,i(t.$t("Rejection reason")),1),u(_,{id:"reason",value:e.form.reject_reason,placeholder:t.$t("Rejection reason"),"onUpdate:input":o[2]||(o[2]=r=>e.form.reject_reason=r)},null,8,["value","placeholder"]),e.errors.reject_reason?(a(),d("p",Ee,i(e.errors.reject_reason[0]),1)):n("",!0)])):n("",!0),s("div",null,[s("label",Le,i(t.$t("Category")),1),u(v,{id:"category_id",value:(j=e.form.category)==null?void 0:j.id,"onUpdate:value":o[3]||(o[3]=r=>{const q=m(y).categories.find(se=>se.id==r);e.form.category={id:r??void 0,name:q?q.name:""}})},{default:f(()=>[s("option",Ne,i(t.$t("Select Category")),1),(a(!0),d(C,null,w(m(y).categories,r=>(a(),d("option",{key:r.id,value:r.id},i(r.name),9,Oe))),128))]),_:1},8,["value"]),e.errors["category.id"]?(a(),d("p",Be,i(e.errors["category.id"][0]),1)):n("",!0)]),!m(y).isLoading&&((E=e.form.category)!=null&&E.id)?(a(),d("div",Ge,[s("label",Pe,i(t.$t("Sub Category")),1),u(v,{id:"sub_category_id",value:(L=e.form.sub_category)==null?void 0:L.id,"onUpdate:value":o[4]||(o[4]=r=>{e.form.sub_category={id:r??void 0}})},{default:f(()=>[s("option",Re,i(t.$t("Select Sub Category")),1),(a(!0),d(C,null,w(m(y).subCategories,r=>(a(),d("option",{key:r.id,value:r.id},i(r.name),9,Ve))),128))]),_:1},8,["value"]),e.errors["sub_category.id"]?(a(),d("p",qe,i(e.errors["sub_category.id"][0]),1)):n("",!0)])):n("",!0),!m(y).isLoading&&((N=e.form.sub_category)!=null&&N.id)?(a(),d("div",Ie,[s("label",ze,i(t.$t("Sub Sub Category")),1),u(v,{id:"sub_sub_category_id",value:(O=e.form.sub_sub_category)==null?void 0:O.id,"onUpdate:value":o[5]||(o[5]=r=>{e.form.sub_sub_category={id:r??void 0}})},{default:f(()=>[s("option",Je,i(t.$t("Select Sub Sub Category")),1),(a(!0),d(C,null,w(m(p).subSubCategories,r=>(a(),d("option",{key:r.id,value:r.id},i(r.name),9,He))),128))]),_:1},8,["value"]),e.errors["sub_sub_category.id"]?(a(),d("p",Ke,i(e.errors["sub_sub_category.id"][0]),1)):n("",!0)])):n("",!0),s("div",null,[s("label",Qe,i(t.$t("Country")),1),u(v,{id:"country_id",name:"country_id",value:(B=e.form.country)==null?void 0:B.id,"onUpdate:value":o[6]||(o[6]=r=>{e.form.country={id:r??void 0}})},{default:f(()=>[s("option",We,i(t.$t("Select Country")),1),(a(!0),d(C,null,w(m(k).countries,r=>(a(),d("option",{key:r.id,value:r.id},i(r.name),9,Xe))),128))]),_:1},8,["value"]),e.errors["country.id"]?(a(),d("p",Ye,i(e.errors["country.id"][0]),1)):n("",!0)]),!m(k).isLoadingAction&&((G=e.form.country)!=null&&G.id)?(a(),d("div",Ze,[s("label",_e,i(t.$t("City")),1),u(v,{id:"city_id",name:"city_id",value:(P=e.form.city)==null?void 0:P.id,"onUpdate:value":o[7]||(o[7]=r=>{e.form.city={id:r??void 0}})},{default:f(()=>[s("option",et,i(t.$t("Select City")),1),(a(!0),d(C,null,w(m(k).cities,r=>(a(),d("option",{key:r.id,value:r.id},i(r.name),9,tt))),128))]),_:1},8,["value"]),e.errors["city.id"]?(a(),d("p",ot,i(e.errors["city.id"][0]),1)):n("",!0)])):n("",!0),s("div",null,[s("label",rt,i(t.$t("Phone Number")),1),u(ee,{id:"phone_number","onUpdate:phoneNumber":o[8]||(o[8]=r=>e.form.user.phone_number=r),"onUpdate:countryCode":o[9]||(o[9]=r=>e.form.user.country_code=r),value:(R=e.form.user)==null?void 0:R.phone_number,valueCountryCode:((V=e.form.user)==null?void 0:V.country_code)??"+212"},null,8,["value","valueCountryCode"]),e.errors["user.country_code"]||e.errors["user.phone_number"]?(a(),d("p",it,i(e.errors["user.country_code"][0]??e.errors["user.phone_number"][0]),1)):n("",!0)]),s("div",null,[s("label",at,i(t.$t("Price")),1),u(A,{type:"number",id:"price",name:"price",value:e.form.price,placeholder:t.$t("Price"),"onUpdate:input":o[10]||(o[10]=r=>e.form.price=r),step:.01},null,8,["value","placeholder"]),e.errors.price?(a(),d("p",st,i(e.errors.price[0]),1)):n("",!0)]),m(b).data_filters_category.length?(a(),d("div",dt,[u(xe,{data:m(b).data_filters_category,"onOn:update":K,initialData:e.form.filters},null,8,["data","initialData"])])):n("",!0),s("div",lt,[s("label",nt,i(t.$t("Description")),1),u(te,{"onUpdate:input":o[11]||(o[11]=r=>e.form.description=r),value:e.form.description,placeholder:t.$t("Description")},null,8,["value","placeholder"]),e.errors.description?(a(),d("p",ut,i(e.errors.description[0]),1)):n("",!0)]),s("div",mt,[s("label",ct,i(t.$t("Media")),1),u(oe,{"onOn:setMedia":Q,"onOn:unSetMedia":W,"onOn:setAsMainMedia":X,mediaFiles:e.form.media},null,8,["mediaFiles"]),e.errors.media?(a(),d("p",ft,i(e.errors.media[0]),1)):n("",!0)])]),e.form?(a(),d("div",yt,[s("div",bt,[s("label",gt,i(t.$t("Map")),1),s("div",vt,[u(ie,{center:{lat:typeof e.form.latitude=="number"?e.form.latitude:e.form.latitude!==null&&e.form.latitude!==void 0?parseFloat(String(e.form.latitude)):15.5527,lng:typeof e.form.longitude=="number"?e.form.longitude:e.form.longitude!==null&&e.form.longitude!==void 0?parseFloat(String(e.form.longitude)):48.5164},zoom:10,options:H,class:"w-full h-[500px]"},{default:f(()=>[(a(),ue(re,{key:1,position:{lat:typeof e.form.latitude=="number"?e.form.latitude:e.form.latitude!==null&&e.form.latitude!==void 0?parseFloat(String(e.form.latitude)):15.5527,lng:typeof e.form.longitude=="number"?e.form.longitude:e.form.longitude!==null&&e.form.longitude!==void 0?parseFloat(String(e.form.longitude)):48.5164},clickable:!0,draggable:!0,onClick:o[12]||(o[12]=r=>{e.form.latitude=r.latLng.lat(),e.form.longitude=r.latLng.lng()}),onDragend:o[13]||(o[13]=r=>{e.form.latitude=r.latLng.lat(),e.form.longitude=r.latLng.lng()})},null,8,["position"]))]),_:1},8,["center"])]),e.errors.latitude?(a(),d("p",ht,i(e.errors.latitude[0]),1)):n("",!0),e.errors.longitude?(a(),d("p",xt,i(e.errors.longitude[0]),1)):n("",!0)])])):n("",!0)]),u(ae,{type:"submit",color:"blue",class:"w-fit place-self-end flex items-center gap-1",disabled:g.value,loading:g.value},{default:f(()=>[o[15]||(o[15]=s("i",{class:"mgc_save_2_line text-xl"},null,-1)),me(" "+i(e.form.id?t.$t("Update"):t.$t("Create")),1)]),_:1},8,["disabled","loading"])],32)}}});export{Tt as _};
